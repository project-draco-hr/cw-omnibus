{
  ArrayList<String> visited=new ArrayList<String>();
  if (network.isNetworkAvailable()) {
    inProgress.set(true);
    broadcastStatus();
    try {
      URL jsonUrl=new URL(SYNC_URL);
      ReadableByteChannel rbc=Channels.newChannel(jsonUrl.openStream());
      FileOutputStream fos=openFileOutput(SYNC_LOCAL_FILE,0);
      fos.getChannel().transferFrom(rbc,0,1 << 16);
      JSONObject json=AppUtils.load(this,SYNC_LOCAL_FILE);
      for (Iterator<String> i=json.keys(); i.hasNext(); ) {
        String title=i.next();
        String url=json.getString(title);
        Entry entry=new Entry(title,url);
        String filename=entry.getFilename();
        File imageFile=new File(getFilesDir(),filename);
        if (!imageFile.exists()) {
          visited.add(filename);
          URL imageUrl=new URL(jsonUrl,entry.getUrl());
          rbc=Channels.newChannel(imageUrl.openStream());
          fos=new FileOutputStream(imageFile);
          fos.getChannel().transferFrom(rbc,0,1 << 16);
        }
      }
      String[] children=getFilesDir().list();
      if (children != null) {
        for (int i=0; i < children.length; i++) {
          String filename=children[i];
          if (!SYNC_LOCAL_FILE.equals(filename) && !visited.contains(filename)) {
            new File(getFilesDir(),filename).delete();
          }
        }
      }
    }
 catch (    Exception ex) {
      Log.e(TAG,"Exception syncing",ex);
      AppUtils.cleanup(this);
    }
 finally {
      inProgress.set(false);
      broadcastStatus();
      syncCompleted();
    }
  }
}
